(this.webpackJsonpraycast=this.webpackJsonpraycast||[]).push([[0],{20:function(t,e,n){},21:function(t,e,n){"use strict";n.r(e);var i=n(0),o=n.n(i),s=n(5),r=n.n(s),a=n(1);function c(t,e){this.x=t,this.y=e}function h(t){this.height=t,this.size=10,this.grid=[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,1,0,1],[1,0,0,0,0,1,0,1,0,1],[1,0,0,0,0,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,1],[1,0,1,1,0,0,0,0,0,1],[1,0,1,1,1,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1]]}function u(t,e){return new c(Math.floor(t.x/e),Math.floor(t.y/e))}c.prototype.add=function(t,e){return new c(this.x+t,this.y+e)},c.prototype.distance=function(t){return Math.hypot(this.x-t.x,this.y-t.y)},h.prototype.isWall=function(t){const e=u(t,this.height);return this.isWithinBounds(t)&&1===this.grid[e.y][e.x]},h.prototype.isWithinBounds=function(t){const e=u(t,this.height);return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size};const l=2*Math.PI;function d(t){return t*Math.PI/180}class p extends o.a.Component{constructor(...t){super(...t),this.wallsRef=o.a.createRef(),this.playerRef=o.a.createRef(),this.raysRef=o.a.createRef()}componentDidMount(){this.drawWalls(),this.drawPlayer(),this.drawRays()}drawWalls(){const t=this.wallsRef.current.getContext("2d"),e=this.props,n=e.map,i=e.size/n.size;t.fillStyle="blue",n.grid.forEach((e,n)=>{e.forEach((e,o)=>{1===e&&t.fillRect(o*i,n*i,i,i)})})}drawPlayer(){const t=this.playerRef.current.getContext("2d"),e=this.props,n=e.map,i=e.player,o=e.size,s=i.position,r=s.x/n.height,a=s.y/n.height,c=o/n.size,h=r*c,u=a*c;t.clearRect(0,0,o,o),t.fillStyle="green",t.beginPath(),t.arc(h,u,5,0,l),t.fill()}drawRays(){const t=this.raysRef.current.getContext("2d"),e=this.props,n=e.map,i=e.rays,o=e.size,s=o/n.size;t.clearRect(0,0,o,o),t.beginPath(),t.strokeStyle="green";for(let r=0;r<i.length;r+=16){const e=i[r],a=e.angle,c=e.distance,h=e.origin,u=h.x/n.height,l=h.y/n.height,d=c/n.height,p=u*s,f=l*s,y=o/n.size*d;t.moveTo(p,f),t.lineTo(p+y*Math.cos(a),f+y*-Math.sin(a)),t.stroke()}}componentDidUpdate(t){t.rays!==this.props.rays&&(this.drawPlayer(),this.drawRays())}render(){const t=this.props.size;return o.a.createElement("div",{style:f.container},o.a.createElement("canvas",{ref:this.wallsRef,height:t,width:t,style:f.layer}),o.a.createElement("canvas",{ref:this.playerRef,height:t,width:t,style:f.layer}),o.a.createElement("canvas",{ref:this.raysRef,height:t,width:t,style:f.layer}))}}const f={container:{position:"relative"},layer:{position:"absolute",top:0,left:0}};function y(t,e,n){this.origin=n,this.angle=function(t){const e=t%l;return e<0?e+l:e}(e),this.distance=function(t,e,n){const i=e>0&&e<Math.PI,o=e<.25*l||e>.75*l,s=function(t,e,n,i,o){const s=Math.floor(e.y/t.height)*t.height+(i?-.01:t.height),r=new c(e.x+(e.y-s)/Math.tan(n),s),a=i?-t.height:t.height,h=Math.abs(t.height/Math.tan(n))*(o?1:-1);return m(t,r,h,a).distance(e)}(t,n,e,i,o),r=function(t,e,n,i,o){const s=Math.floor(e.x/t.height)*t.height+(o?t.height:-.01),r=e.y+(e.x-s)*Math.tan(n),a=new c(s,r),h=o?t.height:-t.height,u=Math.abs(t.height*Math.tan(n))*(i?-1:1);return m(t,a,h,u).distance(e)}(t,n,e,i,o);return Math.min(s,r)}(t,this.angle,n)}function m(t,e,n,i){return t.isWithinBounds(e)?t.isWall(e)?e:m(t,e.add(n,i),n,i):new c(1/0,1/0)}function g(t,e,n){this.position=new c(t,e),this.direction=n}function b(t,e,n){return t.isWall(e)?0:n}g.prototype.castRays=function(t,e,n){const i=e/n,o=this.direction+e/2;return new Array(n).fill(0).map((t,e)=>o-e*i).map(e=>new y(t,e,this.position))},g.prototype.turnRight=function(t){this.direction-=.025*t/16},g.prototype.turnLeft=function(t){this.direction+=.025*t/16},g.prototype.moveForward=function(t,e){const n=e/16*1.4*Math.cos(this.direction),i=e/16*1.4*Math.sin(this.direction);this.position=this.position.add(b(t,this.position.add(n,0),n),b(t,this.position.add(0,-i),-i))},g.prototype.moveBackward=function(t,e){const n=e/16*1.4*Math.cos(this.direction),i=e/16*1.4*Math.sin(this.direction);this.position=this.position.add(b(t,this.position.add(-n,0),-n),b(t,this.position.add(0,i),i))},g.prototype.moveLeft=function(t,e){const n=e/16*1.4*Math.cos(this.direction+Math.PI/2),i=e/16*1.4*Math.sin(this.direction+Math.PI/2);this.position=this.position.add(b(t,this.position.add(n,0),n),b(t,this.position.add(0,-i),-i))},g.prototype.moveRight=function(t,e){const n=e/16*1.4*Math.cos(this.direction+Math.PI/2),i=e/16*1.4*Math.sin(this.direction+Math.PI/2);this.position=this.position.add(b(t,this.position.add(-n,0),-n),b(t,this.position.add(0,i),i))};var w=n(2),v=n(6),M=n.n(v);function E({color:t,distance:e,mapHeight:n,number:i,resolution:s,screenHeight:r,screenWidth:a}){const c=Math.min(n/e*255,r),h=a/s,u=(r-c)/2,l={backgroundColor:M()(t).darken(e/460).hex(),height:c,left:i*h,width:h,position:"absolute",top:u};return o.a.createElement("div",{style:l})}function R({height:t,mapHeight:e,player:n,rays:s,resolution:r,width:a}){const c=Object(i.useMemo)(()=>Object(w.a)({},j.container,{height:t,width:a}),[t,a]);return o.a.createElement("div",{style:c},o.a.createElement("div",{style:j.ceiling}),o.a.createElement("div",{style:j.floor}),s.map((i,s)=>o.a.createElement(E,{color:"#0000FF",distance:k(i,n),key:s,mapHeight:e,number:s,resolution:r,screenHeight:t,screenWidth:a})))}function k(t,e){return t.distance*Math.cos(t.angle-e.direction)}const j={container:{border:"1px solid black",position:"relative"},ceiling:{backgroundColor:"SlateGrey",position:"absolute",left:0,right:0,bottom:"50%",top:0},floor:{backgroundColor:"Gainsboro",position:"absolute",left:0,right:0,bottom:0,top:"50%"}};var O=n(7),x=n.n(O);function z(t,e){switch(e.type){case"down":return Object(w.a)({},t,{[e.key]:!0});case"up":return Object(w.a)({},t,{[e.key]:!1});default:return t}}function P(t,{andThen:e=(()=>{})}){const n=function(t,e){const n=Object(i.useReducer)(t,e),o=Object(a.a)(n,2),s=o[0],r=o[1],c=Object(i.useRef)(s);return Object(i.useEffect)(()=>{c.current=s},[s]),[c,r]}(z,{}),o=Object(a.a)(n,2),s=o[0],r=o[1];!function(t){const e=Object(i.useRef)(),n=Object(i.useRef)();Object(i.useEffect)(()=>{n.current=window.performance.now()},[]),Object(i.useEffect)(()=>(e.current=requestAnimationFrame((function i(o){e.current=requestAnimationFrame(i),t(o-n.current),n.current=o})),()=>cancelAnimationFrame(e.current)),[t])}(Object(i.useCallback)(n=>{let i=!1;x()(t,(t,e)=>{s.current[e]&&(i=!0,t(n))}),i&&e()},[s,t,e])),Object(i.useEffect)(()=>{const e=Object.keys(t);function n(t){e.includes(t.code)&&(t.preventDefault(),r({type:"down",key:t.code}))}function i(t){e.includes(t.code)&&(t.preventDefault(),r({type:"up",key:t.code}))}return document.addEventListener("keydown",n),document.addEventListener("keyup",i),()=>{document.removeEventListener("keydown",n),document.removeEventListener("keyup",i)}},[t,r])}const W=d(60),C=new h(64),L=new g(160,160,d(0));const S={container:{display:"flex"}};n(20);r.a.render(o.a.createElement((function(){const t=Object(i.useState)(!0),e=Object(a.a)(t,2),n=e[0],s=e[1],r=function(t,e,n,o){const s=Object(i.useState)([]),r=Object(a.a)(s,2),c=r[0],h=r[1],u=Object(i.useCallback)(()=>{const i=t.castRays(e,n,o);h(i)},[t,e,n,o]);return Object(i.useEffect)(()=>{u()},[u]),P(Object(i.useMemo)(()=>({KeyW:n=>{t.moveForward(e,n)},KeyS:n=>{t.moveBackward(e,n)},KeyA:n=>{t.moveLeft(e,n)},KeyD:n=>{t.moveRight(e,n)},ArrowLeft:e=>{t.turnLeft(e)},ArrowRight:e=>{t.turnRight(e)}}),[t,e]),{andThen:u}),c}(L,C,W,320);return o.a.createElement("div",{style:S.container},o.a.createElement("div",null,o.a.createElement(R,{height:400,mapHeight:C.height,player:L,rays:r,resolution:320,width:740}),o.a.createElement("div",null,o.a.createElement("span",null,"Move using the w, s, a, d, \u2190, and \u2192 keys"),o.a.createElement("div",null,o.a.createElement("label",{htmlFor:"show_minimap"},"Show minimap",o.a.createElement("input",{id:"show_minimap",onChange:()=>s(!n),type:"checkbox",checked:n}))),o.a.createElement("a",{href:"https://github.com/ahuth/raycast"},"Source code"))),n&&o.a.createElement(p,{fov:W,map:C,player:L,rays:r,resolution:320,size:300}))})),document.getElementById("root"))},8:function(t,e,n){t.exports=n(21)}},[[8,1,2]]]);
//# sourceMappingURL=main.85f564b6.chunk.js.map